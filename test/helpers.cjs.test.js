"use strict";var r=require("chai");require("bitcoin-computer-bitcore"),require("axios"),require("child_process"),require("crypto"),require("crypto-js"),require("eciesjs"),require("@endo/static-module-record");var e=require("util");function t(r){return r&&"object"==typeof r&&"default"in r?r:{default:r}}require("url"),require("fs/promises");var n=t(e);const{CHAIN:o,NETWORK:s,BCN_URL:a,RPC_USER:i,RPC_PASSWORD:u,TEST_MNEMONICS:c}=process.env;function p(r){return{smartArgs:r.filter((r=>r._rev)),dumbArgs:r.map((r=>r._rev?"__":r))}}parseInt(process.env.BC_DUST_LIMIT||"",10),parseInt(process.env.BC_DEFAULT_FEE||"",10),parseInt(process.env.BC_SCRIPT_CHUNK_SIZE||"",10),parseInt(process.env.MWEB_HEIGHT||"",10);const l=r=>(Object.prototype.toString.call(r).match(/\s([a-zA-Z]+)/)||[])[1];const v=r=>"object"==typeof r?l(r):l(r).toLowerCase();const f=r=>{if((r=>["number","string","boolean","undefined","Null"].includes(v(r)))(r))return r;if((r=>"Array"===v(r))(r))return r.map(f);if((r=>"Object"===v(r))(r)){const e=Object.keys(r).reduce(((e,t)=>(e[t]=f(r[t]),e)),{});const t=Object.create(Object.getPrototypeOf(r));return Object.assign(t,e)}throw new Error(`Unsupported data type for clone: ${v(r)}`)};var b={exports:{}};var g="win32"===process.platform;var h=n.default;function m(r,e){var t=[];for(var n=0;n<r.length;n++){var o=r[n];o&&"."!==o&&(".."===o?t.length&&".."!==t[t.length-1]?t.pop():e&&t.push(".."):t.push(o))}return t}function d(r){var e=r.length-1;var t=0;for(;t<=e&&!r[t];t++);var n=e;for(;n>=0&&!r[n];n--);return 0===t&&n===e?r:t>n?[]:r.slice(t,n+1)}var w=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/;var _=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/;var j={};function A(r){var e=w.exec(r),t=(e[1]||"")+(e[2]||""),n=e[3]||"";var o=_.exec(n);return[t,o[1],o[2],o[3]]}function y(r){var e=w.exec(r),t=e[1]||"",n=!!t&&":"!==t[1];return{device:t,isUnc:n,isAbsolute:n||!!e[2],tail:e[3]}}function x(r){return"\\\\"+r.replace(/^[\\\/]+/,"").replace(/[\\\/]+/g,"\\")}j.resolve=function(){var r="",e="",t=!1;for(var n=arguments.length-1;n>=-1;n--){var o;if(n>=0?o=arguments[n]:r?(o=process.env["="+r])&&o.substr(0,3).toLowerCase()===r.toLowerCase()+"\\"||(o=r+"\\"):o=process.cwd(),!h.isString(o))throw new TypeError("Arguments to path.resolve must be strings");if(o){var s=y(o),a=s.device,i=s.isUnc,u=s.isAbsolute,c=s.tail;if((!a||!r||a.toLowerCase()===r.toLowerCase())&&(r||(r=a),t||(e=c+"\\"+e,t=u),r&&t))break}}return i&&(r=x(r)),r+(t?"\\":"")+(e=m(e.split(/[\\\/]+/),!t).join("\\"))||"."},j.normalize=function(r){var e=y(r),t=e.device,n=e.isUnc,o=e.isAbsolute,s=e.tail,a=/[\\\/]$/.test(s);return(s=m(s.split(/[\\\/]+/),!o).join("\\"))||o||(s="."),s&&a&&(s+="\\"),n&&(t=x(t)),t+(o?"\\":"")+s},j.isAbsolute=function(r){return y(r).isAbsolute},j.join=function(){var r=[];for(var e=0;e<arguments.length;e++){var t=arguments[e];if(!h.isString(t))throw new TypeError("Arguments to path.join must be strings");t&&r.push(t)}var n=r.join("\\");return/^[\\\/]{2}[^\\\/]/.test(r[0])||(n=n.replace(/^[\\\/]{2,}/,"\\")),j.normalize(n)},j.relative=function(r,e){r=j.resolve(r),e=j.resolve(e);var t=r.toLowerCase();var n=e.toLowerCase();var o=d(e.split("\\"));var s=d(t.split("\\"));var a=d(n.split("\\"));var i=Math.min(s.length,a.length);var u=i;for(var c=0;c<i;c++)if(s[c]!==a[c]){u=c;break}if(0==u)return e;var p=[];for(c=u;c<s.length;c++)p.push("..");return(p=p.concat(o.slice(u))).join("\\")},j._makeLong=function(r){if(!h.isString(r))return r;if(!r)return"";var e=j.resolve(r);return/^[a-zA-Z]\:\\/.test(e)?"\\\\?\\"+e:/^\\\\[^?.]/.test(e)?"\\\\?\\UNC\\"+e.substring(2):r},j.dirname=function(r){var e=A(r),t=e[0],n=e[1];return t||n?(n&&(n=n.substr(0,n.length-1)),t+n):"."},j.basename=function(r,e){var t=A(r)[2];return e&&t.substr(-1*e.length)===e&&(t=t.substr(0,t.length-e.length)),t},j.extname=function(r){return A(r)[3]},j.format=function(r){if(!h.isObject(r))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof r);var e=r.root||"";if(!h.isString(e))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof r.root);var t=r.dir;var n=r.base||"";return t?t[t.length-1]===j.sep?t+n:t+j.sep+n:n},j.parse=function(r){if(!h.isString(r))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof r);var e=A(r);if(!e||4!==e.length)throw new TypeError("Invalid path '"+r+"'");return{root:e[0],dir:e[0]+e[1].slice(0,-1),base:e[2],ext:e[3],name:e[2].slice(0,e[2].length-e[3].length)}},j.sep="\\",j.delimiter=";";var E=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var S={};function T(r){return E.exec(r).slice(1)}function q(r,e){let t=0;return e.map((e=>"__"===e?r[t++]:e))}S.resolve=function(){var r="",e=!1;for(var t=arguments.length-1;t>=-1&&!e;t--){var n=t>=0?arguments[t]:process.cwd();if(!h.isString(n))throw new TypeError("Arguments to path.resolve must be strings");n&&(r=n+"/"+r,e="/"===n[0])}return(e?"/":"")+(r=m(r.split("/"),!e).join("/"))||"."},S.normalize=function(r){var e=S.isAbsolute(r),t=r&&"/"===r[r.length-1];return(r=m(r.split("/"),!e).join("/"))||e||(r="."),r&&t&&(r+="/"),(e?"/":"")+r},S.isAbsolute=function(r){return"/"===r.charAt(0)},S.join=function(){var r="";for(var e=0;e<arguments.length;e++){var t=arguments[e];if(!h.isString(t))throw new TypeError("Arguments to path.join must be strings");t&&(r+=r?"/"+t:t)}return S.normalize(r)},S.relative=function(r,e){r=S.resolve(r).substr(1),e=S.resolve(e).substr(1);var t=d(r.split("/"));var n=d(e.split("/"));var o=Math.min(t.length,n.length);var s=o;for(var a=0;a<o;a++)if(t[a]!==n[a]){s=a;break}var i=[];for(a=s;a<t.length;a++)i.push("..");return(i=i.concat(n.slice(s))).join("/")},S._makeLong=function(r){return r},S.dirname=function(r){var e=T(r),t=e[0],n=e[1];return t||n?(n&&(n=n.substr(0,n.length-1)),t+n):"."},S.basename=function(r,e){var t=T(r)[2];return e&&t.substr(-1*e.length)===e&&(t=t.substr(0,t.length-e.length)),t},S.extname=function(r){return T(r)[3]},S.format=function(r){if(!h.isObject(r))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof r);var e=r.root||"";if(!h.isString(e))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof r.root);return(r.dir?r.dir+S.sep:"")+(r.base||"")},S.parse=function(r){if(!h.isString(r))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof r);var e=T(r);if(!e||4!==e.length)throw new TypeError("Invalid path '"+r+"'");return e[1]=e[1]||"",e[2]=e[2]||"",e[3]=e[3]||"",{root:e[0],dir:e[0]+e[1].slice(0,-1),base:e[2],ext:e[3],name:e[2].slice(0,e[2].length-e[3].length)}},S.sep="/",S.delimiter=":",b.exports=g?j:S,b.exports.posix=S,b.exports.win32=j,describe("helpers",(()=>{describe("splitArgs",(()=>{it("should work for an array of dumb objects",(()=>{r.expect(p([{a:1},{b:2}])).to.deep.eq({dumbArgs:[{a:1},{b:2}],smartArgs:[]})})),it("should work for an array of smart objects",(()=>{r.expect(p([{a:1,_rev:"rev1"},{b:2,_rev:"rev1"}])).to.deep.eq({dumbArgs:["__","__"],smartArgs:[{_rev:"rev1",a:1},{_rev:"rev1",b:2}]})})),it("should work for an array of smart objects",(()=>{r.expect(p([{a:1},{b:2,_rev:"rev1"}])).to.deep.eq({dumbArgs:[{a:1},"__"],smartArgs:[{_rev:"rev1",b:2}]})}))})),describe("mergeArgs",(()=>{it("should work for an array of dumb objects",(()=>{const e=[{a:1}];const t=f(e);r.expect(q(e,["__"])).to.deep.eq([{a:1}]),r.expect(t).to.deep.eq(e)})),it("should work for an array of dumb objects",(()=>{const e=[{a:1},{b:2}];const{smartArgs:t,dumbArgs:n}=p(e);r.expect(q(t,n)).to.deep.eq(e)})),it("should work for an array of smart objects",(()=>{const e=[{a:1,_rev:"rev0"},{b:2,_rev:"rev0"}];const{smartArgs:t,dumbArgs:n}=p(e);r.expect(q(t,n)).to.deep.eq(e)})),it("should work for a mixed array of objects",(()=>{const e=[{a:1},{b:2,_rev:"rev0"}];const{smartArgs:t,dumbArgs:n}=p(e);r.expect(q(t,n)).to.deep.eq(e)}))}))}));
