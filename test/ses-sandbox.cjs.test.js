"use strict";var e=require("chai");require("ses");var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var r="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{};!function(){function e(){var e=Symbol();var t={};var r=function(){};var n=r;return Object.defineProperty(t,"setItem",{get:function(){return function(r){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;if(o===e)throw new TypeError("Failed to execute 'setItem' on 'Storage': 2 arguments required, but only 1 present.");t.hasOwnProperty(String(r))||n(t.length),t[String(r)]=String(o)}}}),Object.defineProperty(t,"getItem",{get:function(){return function(e){return t.hasOwnProperty(String(e))?t[String(e)]:null}}}),Object.defineProperty(t,"removeItem",{get:function(){return function(e){t.hasOwnProperty(String(e))&&delete t[String(e)]}}}),Object.defineProperty(t,"clear",{get:function(){return function(){for(var e in t)delete t[String(e)]}}}),Object.defineProperty(t,"length",{get:function(){return Object.keys(t).length}}),Object.defineProperty(t,"key",{value:function(e){return Object.keys(t)[String(e)]||null}}),Object.defineProperty(t,"itemInsertionCallback",{get:function(){return n},set:function(e){e&&"function"==typeof e||(e=r),n=e}}),t}var t=r;var n=r;Object.defineProperty(t,"Storage",{value:e}),Object.defineProperty(n,"Storage",{value:e}),Object.defineProperty(t,"localStorage",{value:e()}),Object.defineProperty(n,"localStorage",{value:t.localStorage}),Object.defineProperty(t,"sessionStorage",{value:e()}),Object.defineProperty(n,"sessionStorage",{value:t.sessionStorage})}();const n=e=>new Compartment({}).evaluate(e);describe("secureEval",(()=>{it("Should parse a string to a number",(()=>{e.expect(n("100")).to.deep.eq(100)})),it("Should parse a string to a function",(()=>{class t{constructor(e){this.n=e}}const r=n(`(${t})`);e.expect(new r(1)).to.deep.eq(new t(1))})),it("Should be able to evaluate an addition",(()=>{e.expect(n("1 + 1")).to.deep.eq(2)})),it("Should be able to evaluate Math.abs",(()=>{e.expect(n("Math.abs(-500)")).to.deep.eq(500)})),it("Should throw an error when trying to access localStorage",(()=>{localStorage.setItem("x","5"),e.expect(localStorage.getItem("x")).to.deep.eq("5"),e.expect((()=>n("localStorage.getItem('x')"))).throws()})),it("Should throw an error when using the console",(()=>{e.expect((()=>n("console.log('x')"))).throws()}))})),describe("secureApply",(()=>{it("it should work with Math.floor",(()=>{var t,r;e.expect((t=Math.floor,r=[1.75],new Compartment({target:t,thisArgument:void 0,argumentsList:r}).evaluate("Reflect.apply(target, thisArgument, argumentsList)"))).eq(1)}))})),describe("secureConstruct",(()=>{it("it should work with Math.floor",(()=>{class t{constructor(e){this.n=e}}var r,n;e.expect((r=t,n=[1],new Compartment({target:r,argumentsList:n}).evaluate(`Reflect.construct(${r}, argumentsList)`))).to.deep.eq(new t(1))})),it("it should work with Math.floor",(()=>{class t{constructor(e){this.n=e}}e.expect(Reflect.construct(t,[1])).to.deep.eq(new t(1))}))}));
